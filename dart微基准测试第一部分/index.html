<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>ã€ŠDartå¾®åŸºå‡†æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ã€‹ - Lucklyã®åšå®¢ - åœ¨é˜…è¯»ä¸­é‡è§è‡ªå·±</title><meta name="Description" content="æ—©èµ·çš„å¹´è½»äººåšçš„ç½‘ç«™"><meta property="og:title" content="ã€ŠDartå¾®åŸºå‡†æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ã€‹" />
<meta property="og:description" content="
æœ¬æ–‡ä¸»è¦ä»‹ç»
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://luckly.work/dart%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86/" />
<meta property="og:image" content="https://luckly.work/logo.png"/>
<meta property="article:published_time" content="2021-06-04T11:29:53+08:00" />
<meta property="article:modified_time" content="2021-06-04T11:29:53+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://luckly.work/logo.png"/>

<meta name="twitter:title" content="ã€ŠDartå¾®åŸºå‡†æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ã€‹"/>
<meta name="twitter:description" content="
æœ¬æ–‡ä¸»è¦ä»‹ç»
"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://luckly.work/dart%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86/" /><link rel="prev" href="https://luckly.work/dart_vm%E7%9A%84%E7%9B%B8%E5%85%B3%E7%AE%80%E4%BB%8B%E4%B8%8E%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90/" /><link rel="next" href="https://luckly.work/emoji-support/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ã€ŠDartå¾®åŸºå‡†æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ã€‹",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/luckly.work\/dart%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/luckly.work\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","keywords": "flutter, dart","wordcount":  10583 ,
        "url": "https:\/\/luckly.work\/dart%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86\/","datePublished": "2021-06-04T11:29:53+08:00","dateModified": "2021-06-04T11:29:53+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/luckly.work\/images\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "æ—©èµ·çš„å¹´è½»äºº"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Lucklyã®åšå®¢ - åœ¨é˜…è¯»ä¸­é‡è§è‡ªå·±"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/categories/flutter/"> Flutter </a><a class="menu-item" href="/categories/read/"> è¯»ä¹¦ç¬”è®° </a><a class="menu-item" href="/categories/go/"> Go </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><a class="menu-item" href="/about/"> å…³äº </a><a class="menu-item" href="https://github.com/ITmxs" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i> Github </a><a class="menu-item" href="/friend/"><i class='fas fa-user-friends'></i> å‹é“¾ </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Lucklyã®åšå®¢ - åœ¨é˜…è¯»ä¸­é‡è§è‡ªå·±"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/categories/flutter/" title="">Flutter</a><a class="menu-item" href="/categories/read/" title="">è¯»ä¹¦ç¬”è®°</a><a class="menu-item" href="/categories/go/" title="">Go</a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="/about/" title="">å…³äº</a><a class="menu-item" href="https://github.com/ITmxs" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>Github</a><a class="menu-item" href="/friend/" title=""><i class='fas fa-user-friends'></i>å‹é“¾</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">ã€ŠDartå¾®åŸºå‡†æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ã€‹</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>æ—©èµ·çš„å¹´è½»äºº</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/flutter/"><i class="far fa-folder fa-fw"></i>Flutter</a>&nbsp;<a href="/categories/dart/"><i class="far fa-folder fa-fw"></i>dart</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-06-04">2021-06-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 10583 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 22 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://luckly007.oss-cn-beijing.aliyuncs.com/img/f77be1f477e980732d57475d3ddb69d.png"
        data-srcset="https://luckly007.oss-cn-beijing.aliyuncs.com/img/f77be1f477e980732d57475d3ddb69d.png, https://luckly007.oss-cn-beijing.aliyuncs.com/img/f77be1f477e980732d57475d3ddb69d.png 1.5x, https://luckly007.oss-cn-beijing.aliyuncs.com/img/f77be1f477e980732d57475d3ddb69d.png 2x"
        data-sizes="auto"
        alt="https://luckly007.oss-cn-beijing.aliyuncs.com/img/f77be1f477e980732d57475d3ddb69d.png"
        title="https://luckly007.oss-cn-beijing.aliyuncs.com/img/f77be1f477e980732d57475d3ddb69d.png" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#åˆæ­¥è®¾ç½®">åˆæ­¥è®¾ç½®</a></li>
        <li><a href="#ç”ŸæˆåŸºå‡†">ç”ŸæˆåŸºå‡†</a>
          <ul>
            <li><a href="#ä½¿ç”¨-source_genhttpspubdevpackagessource_gen">ä½¿ç”¨ <a href="https://pub.dev/packages/source_gen"><code>source_gen</code></a></a></li>
            <li><a href="#è¿è¡ŒåŸºå‡†">è¿è¡ŒåŸºå‡†</a></li>
          </ul>
        </li>
        <li><a href="#äº†è§£ç»“æœ">äº†è§£ç»“æœ</a>
          <ul>
            <li><a href="#æ˜¾ç¤ºæ”¶é›†çš„åˆ†ææ•°æ®">æ˜¾ç¤ºæ”¶é›†çš„åˆ†ææ•°æ®</a></li>
            <li><a href="#é˜²æ­¢-numiterations">é˜²æ­¢ <code>numIterations</code></a></li>
            <li><a href="#æ¶ˆé™¤-checkstackoverflow">æ¶ˆé™¤ <code>CheckStackOverflow</code></a></li>
            <li><a href="#é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–è®¡ç®—">é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–è®¡ç®—</a></li>
          </ul>
        </li>
        <li><a href="#æœ€ç»ˆåŸºå‡†æµ‹è¯•ç»“æœ">æœ€ç»ˆåŸºå‡†æµ‹è¯•ç»“æœ</a></li>
        <li><a href="#å…³äºåŸºå‡†æµ‹è¯•çš„æœ€åè¯„è®º">å…³äºåŸºå‡†æµ‹è¯•çš„æœ€åè¯„è®º</a></li>
        <li><a href="#ä¸‹ä¸€éƒ¨åˆ†">ä¸‹ä¸€éƒ¨åˆ†</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»</p>
</blockquote>
<p>åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘å¼€å§‹æ”¶åˆ°è¶Šæ¥è¶Šå¤šå…³äºæŸäº›ç‰¹å®š Dart æ“ä½œæ€§èƒ½çš„é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯<a href="https://twitter.com/lets4r" target="_blank" rel="noopener noreffer">Romain Rastel</a>åœ¨ä»–å…³äº<a href="https://github.com/flutter/flutter/issues/71900" target="_blank" rel="noopener noreffer">æé«˜</a> Flutter<a href="https://github.com/flutter/flutter/issues/71900" target="_blank" rel="noopener noreffer">ä¸­ ChangeNotifier æ€§èƒ½çš„</a>å·¥ä½œçš„èƒŒæ™¯ä¸‹æå‡ºçš„æ­¤ç±»é—®é¢˜çš„ç¤ºä¾‹ã€‚</p>
<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼šhttps://mrale.ph/dartvm/</p>
<p>PSï¼šå†…å®¹æ¯”è¾ƒç¹æ‚ï¼Œè¯·é…Œæƒ…è§‚çœ‹</p>
<p>çœ‹èµ·æ¥åƒåˆ›å»ºä¸€ä¸ªåŒ…å«å°‘é‡é¡¹ç›®çš„å›ºå®šé•¿åº¦åˆ—è¡¨ï¼Œæœ‰æ—¶æ¯”åˆ›å»ºä¸€ä¸ªå¯å¢é•¿çš„åˆ—è¡¨æ€§èƒ½è¦ä½å¾—å¤šã€‚<a href="https://t.co/B5opjZkmrX" target="_blank" rel="noopener noreffer">pic.twitter.com/B5opjZkmrX</a></p>
<p>â€” Romain Rastel ğŸ’™ (@lets4r)</p>
<p>2020 å¹´ 11 æœˆ 30 æ—¥</p>
</blockquote>
<p>é‰´äºæˆ‘çš„ç»éªŒï¼Œæˆ‘ç¬¬ä¸€çœ¼å°±çŸ¥é“è¿™ä¸ªç‰¹å®šçš„åŸºå‡†æµ‹è¯•<em>å‡ºäº†</em>ä»€ä¹ˆé—®é¢˜â€¦â€¦ä½†æ˜¯ä¸ºäº†è®²æ•…äº‹ï¼Œè®©æˆ‘å‡è£…æˆ‘æ²¡æœ‰ã€‚é‚£æˆ‘å°†å¦‚ä½•å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<p>æˆ‘é€šå¸¸ä¼šé¦–å…ˆå°è¯•é‡å¤æŠ¥å‘Šçš„æ•°å­—ã€‚åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæˆ‘å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„ Flutter åº”ç”¨ç¨‹åº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ flutter create ubench
$ cd ubench
</code></pre></td></tr></table>
</div>
</div><p>ç„¶ååœ¨<code>lib/benchmark.dart</code>æˆ‘æŠŠä¸‹é¢çš„ä»£ç è¿™æ®µä»£ç å–è‡ª Romain çš„<a href="https://gist.github.com/letsar/ebc99e00540e60d3ec99636108e52e6a" target="_blank" rel="noopener noreffer">è¦ç‚¹</a>å¹¶åšäº†ä¸€ä¸ªå°ä¿®æ­£ï¼šåœ¨åŸå§‹ç‰ˆæœ¬ä¸­ï¼ŒåŸºå‡†åç§°è¢«æ„å¤–äº¤æ¢ï¼Œå› æ­¤<code>fixed-length</code>åŸºå‡†æ­£åœ¨åˆ†é…å¯å¢é•¿çš„åˆ—è¡¨ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// ubench/lib/benchmark.dart
import &#39;package:benchmark_harness/benchmark_harness.dart&#39;;

abstract class Benchmark extends BenchmarkBase {
  const Benchmark(String name) : super(name);

  @override
  void exercise() {
    for (int i = 0; i &lt; 100000; i++) {
      run();
    }
  }
}

class GrowableListBenchmark extends Benchmark {
  const GrowableListBenchmark(this.length) : super(&#39;growable[$length]&#39;);

  final int length;

  @override
  void run() {
    List&lt;int&gt;()..length = length;
  }
}

class FixedLengthListBenchmark extends Benchmark {
  const FixedLengthListBenchmark(this.length) : super(&#39;fixed-length[$length]&#39;);

  final int length;

  @override
  void run() {
    List(length);
  }
}

void main() {
  const GrowableListBenchmark(32).report();
  const FixedLengthListBenchmark(32).report();
}
</code></pre></td></tr></table>
</div>
</div><p>æœ€åæˆ‘ä¼šåœ¨<em>å‘å¸ƒ</em>æ¨¡å¼ä¸‹è¿è¡Œå®ƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ flutter run --release -t lib/benchmark.dart
...
I/flutter (18126): growable[32](RunTime): 31464.890625 us.
I/flutter (18126): fixed-length[32](RunTime): 713.8279800142756 us
</code></pre></td></tr></table>
</div>
</div><p>ç»“æœä¼¼ä¹æ˜¾ç¤ºå›ºå®šé•¿åº¦åˆ—è¡¨çš„åˆ†é…é€Ÿåº¦æ¯”å¯å¢é•¿åˆ—è¡¨å¿« 43 å€ã€‚æˆ‘ä»¬æ˜¯å¦åº”è¯¥å°±æ­¤æç¬”ï¼Œç„¶åé‡æ„æˆ‘ä»¬çš„ä»£ç ä»¥ä½¿ç”¨å°½å¯èƒ½å¤šçš„å›ºå®šé•¿åº¦åˆ—è¡¨ï¼Ÿ</p>
<p>ç»å¯¹ä¸ä¼šâ€¦â€¦æˆ–è€…è‡³å°‘ä¸ä¼šæœŸæœ›æˆ‘ä»¬çš„ä»£ç å˜å¾—å¿« 43 å€ã€‚å®ƒ<em>å®é™…ä¸Š</em>æ˜¯æœ‰æ„ä¹‰çš„å¯å¢é•¿è¶…è¿‡åå•ï¼Œå…¶ä¸­å›ºå®šé•¿åº¦çš„åˆ—è¡¨æ˜¯å¤©ä½œä¹‹åˆå–œæ¬¢å›ºå®šé•¿åº¦çš„åˆ—è¡¨ã€‚å®ƒä»¬çš„å†…å­˜å ç”¨ç•¥å°ï¼Œåˆ†é…é€Ÿåº¦æ›´å¿«ï¼Œè®¿é—®å…ƒç´ çš„é—´æ¥è®¿é—®æ›´å°‘ã€‚ä½†æ˜¯ï¼Œæ‚¨åº”è¯¥åŸºäºå¯¹äº‹ç‰©å¦‚ä½•è¿ä½œçš„æ¸…æ™°ç†è§£ï¼Œè€Œä¸æ˜¯åŸºäºå¾®åŸºå‡†æµ‹è¯•çš„æœªç»è§£é‡Šçš„åŸå§‹ç»“æœï¼Œæ•…æ„åšå‡ºè¿™ç§é€‰æ‹©ã€‚</p>
<p>åœ¨æ²¡æœ‰ä»»ä½•æ‰¹åˆ¤æ€§åˆ†æçš„æƒ…å†µä¸‹ä»åŸå§‹å¾®åŸºå‡†æ•°æ®ä¸­å¾—å‡ºç»“è®ºæ˜¯ä¸å¾®åŸºå‡†æµ‹è¯•ç›¸å…³çš„å¸¸è§é™·é˜±ï¼Œæˆ‘ä»¬åº”è¯¥å°½åŠ›é¿å…è½å…¥å…¶ä¸­ã€‚ä¸å¹¸çš„<code>package:benchmark_harness</code>æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰è®©é¿å…æ­¤ç±»é™·é˜±å˜å¾—æ›´å®¹æ˜“ï¼šå®ƒä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç§ç¼–å†™å¾®åŸºå‡†æµ‹è¯•çš„æ–¹æ³•ï¼Œä½†æ²¡æœ‰ä¸ºä»–ä»¬æä¾›æœ‰å…³å¦‚ä½•éªŒè¯åŸºå‡†æµ‹è¯•å’Œè§£é‡Šå…¶ç»“æœçš„å·¥å…·æˆ–æŒ‡å¯¼ã€‚æ›´ç³Ÿç³•çš„<code>package:benchmark_harness</code>æ˜¯ï¼Œç”šè‡³æ²¡æœ‰å°è¯•è®©ç¼–å†™å‡†ç¡®çš„å¾®åŸºå‡†æµ‹è¯•å˜å¾—éå¸¸ç®€å•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘æˆ‘å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼ç¼–å†™æ­¤åˆ—è¡¨åŸºå‡†æµ‹è¯•ï¼Œè€Œæ— éœ€è¦†ç›–<code>exercise</code>é‡å¤<code>run</code> <code>100000</code>æ¬¡æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// ubench/lib/benchmark-without-exercise.dart
import &#39;package:benchmark_harness/benchmark_harness.dart&#39;;

// Just using BenchmarkBase directly. Rest is the same.
class GrowableListBenchmark extends BenchmarkBase {
  // ...
}

// Just using BenchmarkBase directly. Rest is the same.
class FixedLengthListBenchmark extends BenchmarkBase {
  // ...
}
</code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œæ­¤å˜ä½“å°†æ˜¾ç¤ºå¯å¢é•¿åˆ—è¡¨ä»…æ¯”å›ºå®šé•¿åº¦åˆ—è¡¨æ…¢ 6 å€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ flutter run --release -t lib/benchmark-without-exercise.dart
I/flutter (14407): growable[32](RunTime): 1.8629797056305768 us.
I/flutter (14407): fixed-length[32](RunTime): 0.3052065645659146 us.
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘åº”è¯¥ç›¸ä¿¡å“ªä¸ªåŸºå‡†æµ‹è¯•ç»“æœï¼Ÿ**ä»–ä»¬ä¸¤ä¸ªéƒ½æ²¡æœ‰ï¼**æˆ‘åº”è¯¥æ·±å…¥äº†è§£å¹¶å°è¯•äº†è§£åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>
<p>Flutter å’Œ Dart å·²ç»ä¸ºå¼€å‘äººå‘˜æä¾›äº†è¶³å¤Ÿçš„å·¥å…·æ¥å¼„æ¸…æ¥šä¸ºä»€ä¹ˆåŸºå‡†æ•°æ®ä¼šè¿™æ ·ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå…¶ä¸­ä¸€äº›å·¥å…·æœ‰äº›æ™¦æ¶©éš¾æ‡‚ä¸”éš¾ä»¥å‘ç°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>flutter run --profile</code>Observatory æ¥åˆ†ææ‚¨çš„åº”ç”¨ç¨‹åºï¼Œä½†æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æœ¬æœºåˆ†æå™¨ï¼ˆä¾‹å¦‚<code>simpleperf</code> åœ¨ Android ä¸Šæˆ–åœ¨ iOS ä¸Šçš„ Instrumentsï¼‰æ¥åˆ†æå‘å¸ƒç‰ˆæœ¬ï¼Œè¿™ä¸€ç‚¹å¹¶ä¸ä¸ºäººæ‰€çŸ¥ã€‚åŒæ ·ï¼Œä¸çŸ¥é“ï¼ˆå¾ˆå¯èƒ½åœ¨ä¸€ç»„ä»äº‹ VM çš„å·¥ç¨‹å¸ˆä¹‹å¤–æ ¹æœ¬ä¸çŸ¥é“ï¼‰æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œä» AOT æ„å»ºä¸­è½¬å‚¨ç‰¹å®šæ–¹æ³•çš„å¸¦æ³¨é‡Šçš„åæ±‡ç¼–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ flutter build apk --extra-gen-snapshot-options=--print-flow-graph,\
    --disassemble,\
    --print-flow-graph-filter=FixedLengthListBenchmark.run
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘å¯ä»¥ç”¨è¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†æ¥è§£é‡Šå¦‚ä½•ä½¿ç”¨è¿™äº›å·¥å…·æ¥äº†è§£è¿™äº›åˆ—è¡¨åŸºå‡†æµ‹è¯•ä¸­ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†ç›¸åï¼Œæˆ‘æƒ³å°è¯•æƒ³è±¡å¦‚ä½•ä»æä¾›çš„åŸè¯­ä¸­æ„å»ºç”¨äºåŸºå‡†æµ‹è¯•çš„é›†æˆå·¥å…·é€šè¿‡ Dart å’Œ Flutterã€‚è¯¥å·¥å…·ä¸ä»…åº”è¯¥è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè€Œä¸”è¿˜åº”è¯¥è‡ªåŠ¨ä¸ºå¼€å‘äººå‘˜æä¾›è¶³å¤Ÿçš„æ´å¯ŸåŠ›ï¼Œä»¥å‘ç°ä»–ä»¬åœ¨åŸºå‡†æµ‹è¯•è¿‡ç¨‹ä¸­çŠ¯çš„é”™è¯¯å¹¶å¸®åŠ©ä»–ä»¬è§£é‡Šç»“æœã€‚</p>
<h2 id="åˆæ­¥è®¾ç½®">åˆæ­¥è®¾ç½®</h2>
<p>æˆ‘å·²ç»åœ¨ GitHub ä¸Šåˆ†å‰äº†<code>benchmark_harness</code>åŒ…<a href="https://github.com/mraleph/benchmark_harness" target="_blank" rel="noopener noreffer"><code>mraleph/benchmark_harness</code></a>ã€‚æˆ‘æ‰€æœ‰çš„<em>åŸå‹</em>ä»£ç éƒ½å°†å­˜åœ¨äº<a href="https://github.com/mraleph/benchmark_harness/tree/experimental-cli" target="_blank" rel="noopener noreffer"><code>experimental-cli</code></a>fork çš„ä¸€ä¸ªæ–°åˆ†æ”¯ä¸­ã€‚</p>
<p>ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘å°†è®°å½•è¿™ä¸ªå®éªŒæ€§åŸºå‡† CLI çš„æ¼”å˜ã€‚æˆ‘æƒ³å¼ºè°ƒè¿™ä¸ªå·¥å…·çš„é«˜åº¦å®éªŒæ€§è´¨ï¼šä½ ä¼šæ³¨æ„åˆ°å®ƒçš„ä¸€äº›åŠŸèƒ½æœ€ç»ˆå°†å–å†³äº Dart å’Œ Flutter SDK å†…éƒ¨çš„è¡¥ä¸ã€‚è¿™äº›è¡¥ä¸å¯èƒ½éœ€è¦æ•°å‘¨æˆ–æ•°æœˆæ‰èƒ½å‘å¸ƒï¼Œå¹¶ä¸”å¯ä»¥å°†æˆ‘çš„æ›´æ”¹åˆå¹¶åˆ°å·¥å…·çš„ä¸Šæ¸¸ç‰ˆæœ¬ä¸­ã€‚</p>
<p>æˆ‘é¦–å…ˆæ·»åŠ äº†ä¸€ä¸ªç®€å•çš„<code>bin/benchmark_harness.dart</code>è„šæœ¬ï¼Œå®ƒå°†ä½œä¸ºæˆ‘ä»¬æ–°çš„åŸºå‡†æµ‹è¯•å·¥å…·çš„å…¥å£ç‚¹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ git clone git@github.com:mraleph/benchmark_harness.git
$ cd benchmark_harness
$ cat &gt; bin/benchmark_harness.dart
void main() { print(&#39;Running benchmarks...&#39;); }
^D
</code></pre></td></tr></table>
</div>
</div><p>æœ€åæˆ‘æ”¹å˜<code>pubspec.yaml</code>äº†<code>ubench</code>é¡¹ç›®ï¼ˆè®°ä½å®ƒæ˜¯æˆ‘ä»¬åˆ›å»ºçš„ä¸€ä¸ªç©ºçš„ Flutter é¡¹ç›®æ¥æ‰˜ç®¡æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•ï¼‰ä»¥å¯¹æˆ‘çš„ç‰ˆæœ¬æœ‰è·¯å¾„ä¾èµ–<code>benchmark_harness</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># ubench/pubspec.yaml

dependencies:
  # ...
  benchmark_harness:
    path: ../benchmark_harness
  # ...
</code></pre></td></tr></table>
</div>
</div><p>è¿™å…è®¸æˆ‘<code>benchmark_harness</code>åœ¨<code>ubench</code>é¡¹ç›®ç›®å½•ä¸­è¿è¡Œè„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ flutter pub get
$ flutter pub run benchmark_harness
Running benchmarks...
</code></pre></td></tr></table>
</div>
</div><h2 id="ç”ŸæˆåŸºå‡†">ç”ŸæˆåŸºå‡†</h2>
<p>ä½ æœ‰æ²¡æœ‰çœ‹è¿‡<code>benchmark_harness</code>ä½ çš„åŸºå‡†æµ‹è¯•æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿ</p>
<p>äº‹å®è¯æ˜ï¼Œè¿™ä¸ªåŒ…æ­£åœ¨åšä¸€äº›ç›¸å½“ç®€å•çš„äº‹æƒ…ï¼ˆå¹¶ä¸”åœ¨æŸç§ç¨‹åº¦ä¸Šå¾ˆå¤©çœŸï¼‰ï¼šå®ƒå¯åŠ¨ a <code>Stopwatch</code>ï¼Œç„¶å<code>exercise</code> æ ¹æ®ç§’è¡¨é‡å¤è°ƒç”¨ç›´åˆ° 2 ç§’è¿‡å»ã€‚ç»è¿‡çš„æ—¶é—´é™¤ä»¥<code>exercise</code>è¢«è°ƒç”¨çš„æ¬¡æ•°æ˜¯æŠ¥å‘Šçš„åŸºå‡†åˆ†æ•°ã€‚è‡ªå·±çœ‹çœ‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// benchmark_harness/lib/src/benchmark_base.dart
abstract class BenchmarkBase {
  // Measures the score for the benchmark and returns it.
  double measure() {
    // ...
    // Run the benchmark for at least 2000ms.
    var result = measureFor(exercise, 2000);
    // ...
  }

  // Exercises the benchmark. By default invokes [run] 10 times.
  void exercise() {
    for (var i = 0; i &lt; 10; i++) {
      run();
    }
  }

  // Measures the score for this benchmark by executing it repeatedly until
  // time minimum has been reached.
  static double measureFor(Function f, int minimumMillis) {
    var minimumMicros = minimumMillis * 1000;
    var iter = 0;
    var watch = Stopwatch();
    watch.start();
    var elapsed = 0;
    while (elapsed &lt; minimumMicros) {
      f();
      elapsed = watch.elapsedMicroseconds;
      iter++;
    }
    return elapsed / iter;
  }
}
</code></pre></td></tr></table>
</div>
</div><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ®µä»£ç æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä½¿å®ƒä¸é€‚åˆå¾®åŸºå‡†æµ‹è¯•ï¼šæµ‹é‡å¾ªç¯æœ‰ä¸€å †ä¸<code>exercise</code>è‡ªèº«æ— å…³çš„å¼€é”€ ã€‚æœ€æ˜æ˜¾çš„æ˜¯ï¼Œå®ƒåœ¨æ¯æ¬¡è¿­ä»£æ—¶ä»æ“ä½œç³»ç»Ÿè·å–å½“å‰æ—¶é—´ã€‚è¿˜æœ‰ä¸€ä¸ªå¼€é”€ä¸æµ‹é‡å¾ªç¯å’Œ<code>run</code>åŒ…å«æˆ‘ä»¬æƒ³è¦æµ‹é‡çš„å®é™…æ“ä½œçš„æ–¹æ³•ä½“ä¹‹é—´çš„å¤šçº§è™šæ‹Ÿè°ƒåº¦ç›¸å…³è” ã€‚æœ‰ä¸€ä¸ª<a href="https://github.com/dart-lang/benchmark_harness/pull/38" target="_blank" rel="noopener noreffer">å…¬å…³</a>åå¯¹<code>benchmark_harness</code>ï¼Œå®ƒè¯•å›¾è§£å†³è°ƒç”¨<code>Stopwatch.elapsedMilliseconds</code>è¿‡äºé¢‘ç¹çš„é—®é¢˜ï¼Œä½†å°½ç®¡è·å¾—äº†æ‰¹å‡†ï¼Œå®ƒè¿˜æ˜¯ä»¥æŸç§æ–¹å¼é™·å…¥äº†å›°å¢ƒã€‚</p>
<p>é¿å…è¿™äº›å¼€é”€çš„æœ€å¥½æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªåŸºå‡†æµ‹è¯•æœ‰ä¸€ä¸ªå•ç‹¬çš„æµ‹é‡å¾ªç¯ã€‚</p>
<p>è¿™å°±æ˜¯å®ƒçš„æ ·å­ã€‚ç”¨æˆ·é€šè¿‡ç¼–å†™å¸¦æœ‰<code>@benchmark</code>æ³¨é‡Šæ ‡è®°çš„é¡¶çº§å‡½æ•°æ¥å£°æ˜å¾®åŸºå‡†æµ‹è¯•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// ubench/lib/main.dart
import &#39;package:benchmark_harness/benchmark_harness.dart&#39;;

const N = 32;

@benchmark
void allocateFixedArray() {
  List.filled(N, null, growable: false);
}

@benchmark
void allocateGrowableArray() {
  List.filled(N, null, growable: true);
}
</code></pre></td></tr></table>
</div>
</div><p>ç„¶ååŸºå‡†æµ‹è¯•å·¥å…·ä¼šç”Ÿæˆä¸€ä¸ªè¾…åŠ©æºæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªåŸºå‡†æµ‹è¯•çš„æµ‹é‡å¾ªç¯ï¼Œä»¥åŠä¸€äº›ä»£ç æ¥é€‰æ‹©å“ªäº›åŸºå‡†æµ‹è¯•åº”è¯¥åœ¨ç¼–è¯‘æ—¶è¿è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// ubench/lib/main.benchmark.dart
import &#39;package:benchmark_harness/benchmark_harness.dart&#39; as benchmark_harness;

import &#39;package:ubench/main.dart&#39; as lib;

// ...

void _$measuredLoop$allocateFixedArray(int numIterations) {
  while (numIterations-- &gt; 0) {
    lib.allocateFixedArray();
  }
}

// ...

const _targetBenchmark =
    String.fromEnvironment(&#39;targetBenchmark&#39;, defaultValue: &#39;all&#39;);
const _shouldMeasureAll = _targetBenchmark == &#39;all&#39;;

const _shouldMeasure$allocateFixedArray =
    _shouldMeasureAll || _targetBenchmark == &#39;allocateFixedArray&#39;;

// ...

void main() {
  benchmark_runner.runBenchmarks(const {
    // ...
    if (_shouldMeasure$allocateFixedArray)
      &#39;allocateFixedArray&#39;: _$measuredLoop$allocateFixedArray,
    // ...
  });
}
</code></pre></td></tr></table>
</div>
</div><p>å®é™…æµ‹é‡å°†å‘ç”Ÿåœ¨ä¸€ä¸ªç®€å•çš„<code>measure</code>è¾…åŠ©å‡½æ•°ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// benchmark_harness/lib/benchmark_runner.dart

/// Runs the given measured [loop] function with an exponentially increasing
/// parameter values until it finds one that causes [loop] to run for at
/// least [thresholdMilliseconds] and returns [BenchmarkResult] describing
/// that run.
BenchmarkResult measure(void Function(int) loop,
    {required String name, int thresholdMilliseconds = 5000}) {
  var n = 2;
  final sw = Stopwatch();
  do {
    n *= 2;
    sw.reset();
    sw.start();
    loop(n);
    sw.stop();
  } while (sw.elapsedMilliseconds &lt; thresholdMilliseconds);

  return BenchmarkResult(
    name: name,
    elapsedMilliseconds: sw.elapsedMilliseconds,
    numIterations: n,
  );
}
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ä»ä¸€ä¸ªéå¸¸ç®€å•çš„å®ç°å¼€å§‹ï¼Œä½†å®ƒåº”è¯¥èƒ½æ»¡è¶³æˆ‘ä»¬æœ€åˆçš„å¾®åŸºå‡†æµ‹è¯•éœ€æ±‚ã€‚ç„¶è€Œå¯¹äºæ›´å¤æ‚çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦åšä¸€äº›æ›´ä¸¥æ ¼çš„äº‹æƒ…ï¼šä¾‹å¦‚ï¼Œä¸€æ—¦<code>numIterations</code>å‘ç°è¶³å¤Ÿå¤§ï¼Œ æˆ‘ä»¬å¯ä»¥é‡å¤<code>loop(numIterations)</code>å¤šæ¬¡å¹¶è¯„ä¼°è§‚å¯Ÿåˆ°çš„è¿è¡Œæ—¶é—´çš„ç»Ÿè®¡ç‰¹æ€§ã€‚</p>
<h3 id="ä½¿ç”¨-source_genhttpspubdevpackagessource_gen">ä½¿ç”¨ <a href="https://pub.dev/packages/source_gen" target="_blank" rel="noopener noreffer"><code>source_gen</code></a></h3>
<p>è¦ç”Ÿæˆï¼Œ<code>main.benchmark.dart</code>æˆ‘ä»¬éœ€è¦è§£æ<code>main.dart</code>å¹¶æ‰¾åˆ°æ‰€æœ‰å¸¦æœ‰<code>@benchmark</code>æ³¨è§£çš„å‡½æ•°ã€‚å¹¸è¿çš„æ˜¯ï¼ŒDart æœ‰è®¸å¤šç”¨äºä»£ç ç”Ÿæˆçš„è§„èŒƒå·¥å…·ï¼Œè¿™ä½¿å¾—è¿™éå¸¸å®¹æ˜“ã€‚</p>
<p>æˆ‘æ‰€è¦åšçš„å°±æ˜¯ä¾èµ–<code>package:source_gen</code>å¹¶å®šä¹‰ä¸€ä¸ªå­ç±»<a href="https://pub.dev/documentation/source_gen/latest/source_gen/GeneratorForAnnotation-class.html" target="_blank" rel="noopener noreffer"><code>GeneratorForAnnotation</code></a>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// benchmark_harness/lib/src/benchmark_generator.dart

class BenchmarkGenerator extends GeneratorForAnnotation&lt;Benchmark&gt; {
  // ...
  @override
  String generateForAnnotatedElement(
      Element element, ConstantReader annotation, BuildStep buildStep) {
    final name = element.name;
    return &#39;&#39;&#39;
void ${_\$measuredLoop\$$name}(int numIterations) {
  while (numIterations-- &gt; 0) {
    lib.${name}();
  }
}
&#39;&#39;&#39;;
  }
}
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘æŠŠå®ƒåŒ…è£¹åœ¨ä¸€ä¸ª <code>Builder</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// benchmark_harness/lib/builder.dart

Builder benchmarkLibraryBuilder(BuilderOptions options) =&gt;
    LibraryBuilder(BenchmarkGenerator(), generatedExtension: &#39;.benchmark.dart&#39;);
</code></pre></td></tr></table>
</div>
</div><p>æœ€å<code>Builder</code>é€šè¿‡æ›å…‰è¿™å®¶å·¥å‚<code>build.yaml</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># benchmark_harness/build.yaml

builders:
  benchmark:
    import: &#34;package:benchmark_harness/builder.dart&#34;
    builder_factories: [&#34;benchmarkLibraryBuilder&#34;]
    build_extensions: {&#34;.dart&#34;: [&#34;.benchmark.dart&#34;]}
    auto_apply: dependents
    build_to: source
</code></pre></td></tr></table>
</div>
</div><p>åŸºæœ¬ä¸Šå°±æ˜¯è¿™æ ·ã€‚ç°åœ¨ï¼Œæ¯å½“æˆ‘è¿è¡Œæ—¶<code>build_runner build</code>ï¼Œ<code>ubench</code>æˆ‘éƒ½ä¼š<code>lib/main.benchmark.dart</code>ä¸ºä»¥ä¸‹å®šä¹‰çš„åŸºå‡†ç”Ÿæˆ<code>lib/main.dart</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">ubench $ flutter pub run build_runner build
ubench $ ls lib/*.benchmark.dart
lib/main.benchmark.dart
</code></pre></td></tr></table>
</div>
</div><p>æ‚¨å¯ä»¥åœ¨æ­¤<a href="https://github.com/mraleph/benchmark_harness/commit/474de50c574339b4ed11267d5885bad37060306b" target="_blank" rel="noopener noreffer">æäº¤ä¸­</a>æŸ¥çœ‹ä»£ç ç”Ÿæˆå™¨çš„å®Œæ•´æºä»£ç ã€‚</p>
<h3 id="è¿è¡ŒåŸºå‡†">è¿è¡ŒåŸºå‡†</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†é€‚å½“çš„ä¼ é€’<code>--dart-define</code> ç»™æ¥æ‰§è¡Œå•ä¸ªåŸºå‡†æµ‹è¯•<code>flutter run</code>ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ flutter run --release --dart-define targetBenchmark=allocateFixedArray -t lib/main.benchmark.dart
Launching lib/main.benchmark.dart on Pixel 3a in release mode...
Running Gradle task &#39;assembleRelease&#39;...
Running Gradle task &#39;assembleRelease&#39;... Done                       4.9s
âœ“ Built build/app/outputs/flutter-apk/app-release.apk (4.9MB).
Installing build/app/outputs/flutter-apk/app.apk...              1,268ms

Flutter run key commands.
h Repeat this help message.
c Clear the screen
q Quit (terminate the application on the device).
I/flutter (12463): benchmark_harness[{&#34;event&#34;:&#34;benchmark.running&#34;}]
I/flutter (12463): benchmark_harness[{&#34;event&#34;:&#34;benchmark.result&#34;,&#34;params&#34;:{...}}]
I/flutter (12463): benchmark_harness[{&#34;event&#34;:&#34;benchmark.done&#34;}]

Application finished.
</code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯æ‰‹åŠ¨æ‰§è¡Œæ­¤æ“ä½œå¹¶ä¸æ˜¯æˆ‘çš„ç›®æ ‡ã€‚ç›¸åï¼Œæˆ‘è¦æ”¹å˜<code>bin/benchmark_harness.dart</code>è„šæœ¬æ—¢æ„å»ºåŸºå‡†ï¼Œç„¶åè¿è¡Œæ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæ”¶é›†çš„åŸºå‡†æµ‹è¯•ç»“æœï¼ˆå…¨ä»£ç ä¸­çœ‹åˆ°<a href="https://github.com/mraleph/benchmark_harness/commit/13941c5e0d58c94bf78d694e619dacb4bfc3ba3c" target="_blank" rel="noopener noreffer">è¿™ä¸ª</a>æ‰¿è¯ºï¼‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// benchmark_harness/bin/benchmark_harness.dart

void main() async {
  // ...
  // Generate benchmark wrapper scripts.
  print(red(&#39;Generating benchmark wrappers&#39;));
  &#39;flutter pub run build_runner build&#39;.start(progress: Progress.devNull());

  // Run all generated benchmarks.
  final resultsByFile = &lt;String, Map&lt;String, BenchmarkResult&gt;&gt;{};
  for (var file in find(&#39;*.benchmark.dart&#39;).toList().map(p.relative)) {
    resultsByFile[file] = await runBenchmarksIn(file);
  }

  // Report results.
  // ...
}

/// Runs all benchmarks in `.benchmark.dart` [file] one by one and collects
/// their results.
Future&lt;Map&lt;String, BenchmarkResult&gt;&gt; runBenchmarksIn(String file) async {
  // ...
}
</code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·çš„å¸®åŠ©è„šæœ¬ä½¿è¿è¡ŒåŸºå‡†æµ‹è¯•å˜å¾—éå¸¸ç®€å•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ flutter pub run benchmark_harness
Generating benchmark wrappers
Found 2 benchmarks in lib/main.benchmark.dart
  measuring allocateFixedArray
    benchmark is running
      done
  measuring allocateGrowableArray
    benchmark is running
      done

--------------------------------------------------------------------------------

Results for lib/main.benchmark.dart
allocateFixedArray: 0.0000030226074159145355 ms/iteration (fastest)
allocateGrowableArray: 0.00018900632858276367 ms/iteration (62.5 times as slow)
</code></pre></td></tr></table>
</div>
</div><h2 id="äº†è§£ç»“æœ">äº†è§£ç»“æœ</h2>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªè¿è¡Œå¾®åŸºå‡†æµ‹è¯•çš„å·¥å…·ï¼Œè®©æˆ‘ä»¬æ‰©å±•å®ƒï¼Œæ”¯æŒåœ¨è¿è¡Œæ—¶åˆ†æåŸºå‡†æµ‹è¯•ã€‚è¿™å°†å¸®åŠ©æˆ‘ä»¬äº†è§£åŸºå‡†æµ‹è¯•åœ¨å“ªé‡ŒèŠ±è´¹æ—¶é—´å¹¶ç¡®è®¤å®ƒæ­£åœ¨æµ‹é‡æˆ‘ä»¬æƒ³è¦å®ƒæµ‹é‡çš„å†…å®¹ã€‚</p>
<p>Flutter çš„<em>å‘å¸ƒ</em>ç‰ˆæœ¬ä¸åŒ…æ‹¬ Dart çš„å†…ç½®åˆ†æå™¨ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿ç”¨åŸç”Ÿåˆ†æå™¨ï¼Œä¾‹å¦‚<code>simpleperf</code>åœ¨ Android ä¸Šã€‚</p>
<p>Androidæœ‰å…¨é¢<a href="https://android.googlesource.com/platform/system/extras/&#43;/master/simpleperf/doc/android_application_profiling.md" target="_blank" rel="noopener noreffer">çš„æ–‡æ¡£</a>ä½¿ç”¨<code>simpleperf</code>ï¼Œè¿™æˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œé‡å¤ã€‚<code>simpleperf</code>è¿˜å¸¦æœ‰è°ƒç”¨çš„ C++ï¼ˆå’Œ Javaï¼‰ä»£ç <a href="https://android.googlesource.com/platform/system/extras/&#43;/master/simpleperf/app_api/cpp/simpleperf.cpp" target="_blank" rel="noopener noreffer"><code>app_api</code></a>ï¼Œè¿™äº›ä»£ç å¯ä»¥é“¾æ¥åˆ°åº”ç”¨ç¨‹åºä¸­ä»¥å…è®¸ä»¥ç¼–ç¨‹æ–¹å¼è®¿é—®åˆ†æå™¨ã€‚</p>
<p>å®é™…ä¸Š<code>app_api</code>å¹¶æ²¡æœ‰åšä»»ä½•è¿‡äºèŠ±å“¨çš„äº‹æƒ…ï¼šå®ƒåªæ˜¯<code>simpleperf</code>ä½¿ç”¨æ­£ç¡®çš„å‘½ä»¤è¡Œé€‰é¡¹è¿è¡Œ äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™å°±æ˜¯æˆ‘å†³å®šå°†ç›¸å…³éƒ¨åˆ†ç§»æ¤<code>app_api</code>åˆ°çº¯ Dart çš„åŸå› ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»‘å®šåˆ°<code>app_api</code>ä½¿ç”¨ Dart FFI çš„C++ ç‰ˆæœ¬ï¼Œä½†è¿™éœ€è¦å°†è¿™ä¸ª C++ æ‰“åŒ…æˆä¸€ä¸ª<em>Flutter æ’ä»¶</em>ï¼Œè¿™ä½¿äº‹æƒ…å˜å¾—å¤æ‚ï¼Œå› ä¸ºå®ƒ<code>benchmark_harness</code>æ˜¯ä¸€ä¸ªçº¯ Dart åŒ…ï¼Œå®ƒä¸èƒ½ä¾èµ–äº Flutter æ’ä»¶åŒ…ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// benchmark_harness/lib/src/simpleperf/profiling_session.dart

class ProfilingSession {
  Future&lt;void&gt; start(
      {RecordingOptions options = const RecordingOptions()}) async {
    // ...
    await _startSimpleperfProcess(options);
  }

  Future&lt;void&gt; _startSimpleperfProcess(RecordingOptions options) async {
    final simpleperfBinary = await _findSimplePerf();
    _simpleperf = await Process.start(
      simpleperfBinary,
      [
        &#39;record&#39;,
        &#39;--log-to-android-buffer&#39;,
        &#39;--log&#39;,
        &#39;debug&#39;,
        &#39;--stdio-controls-profiling&#39;,
        &#39;--in-app&#39;,
        &#39;--tracepoint-events&#39;,
        &#39;/data/local/tmp/tracepoint_events&#39;,
        &#39;-o&#39;,
        options.outputFilename ?? _makeOutputFilename(),
        &#39;-e&#39;,
        options.event,
        &#39;-f&#39;,
        options.frequency.toString(),
        &#39;-p&#39;,
        _getpid().toString(),
        ..._callgraphFlagsFrom(options),
      ],
      workingDirectory: simpleperfDataDir,
    );
    // ...
  }
}
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘è°ƒæ•´<code>benchmark_runner.dart</code>è¿è¡ŒåŸºå‡†æµ‹è¯•å®ƒåˆšåˆšåœ¨åˆ†æå™¨ä¸‹æµ‹é‡å¹¶å°†é…ç½®<code>perf-$benchmarkName.data</code> æ–‡ä»¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚æ­¤æ–‡ä»¶å°†åœ¨åº”ç”¨ç¨‹åºçš„æ•°æ®ç›®å½•ä¸­åˆ›å»ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Future&lt;void&gt; runBenchmarks(Map&lt;String, void Function(int)&gt; benchmarks) async {
  _event(&#39;benchmark.running&#39;);
  final profiler = Platform.isAndroid ? ProfilingSession() : null;
  for (var entry in benchmarks.entries) {
    final result = measure(entry.value, name: entry.key);
    _event(&#39;benchmark.result&#39;, result);

    if (profiler != null) {
      // Run benchmark for the same amount of iterations and profile it.
      await profiler.start(
          options: RecordingOptions(outputFilename: &#39;perf-${entry.key}.data&#39;));
      entry.value(result.numIterations);
      await profiler.stop();
    }
  }
  _event(&#39;benchmark.done&#39;);
}
</code></pre></td></tr></table>
</div>
</div><p>NDK è¿˜é™„å¸¦äº†ä¸€ä¸ªè¾…åŠ©è„šæœ¬<code>api_profiler.py</code>ï¼Œå®ƒå®ç°äº†ä¸¤ä¸ªå‘½ä»¤ï¼š</p>
<ul>
<li><code>api_profiler.py prepare</code> é…ç½®æ‚¨çš„è®¾å¤‡ä»¥è¿›è¡Œåˆ†æ - æˆ‘ä»¬å°†åœ¨è¿è¡ŒåŸºå‡†æµ‹è¯•ä¹‹å‰è°ƒç”¨å®ƒï¼›</li>
<li><code>api_profiler.py collect</code>ä»è®¾å¤‡ä¸­æå–æ”¶é›†çš„é…ç½®æ–‡ä»¶ - æˆ‘ä»¬å°†åœ¨æ‰€æœ‰åŸºå‡†æµ‹è¯•å®Œæˆè¿è¡Œåè°ƒç”¨å®ƒä»¥æå–<code>perf-*.data</code>ä»è®¾å¤‡ç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶ ã€‚</li>
</ul>
<h3 id="æ˜¾ç¤ºæ”¶é›†çš„åˆ†ææ•°æ®">æ˜¾ç¤ºæ”¶é›†çš„åˆ†ææ•°æ®</h3>
<p>NDK çš„<code>simpleperf</code>äºŒè¿›åˆ¶æ–‡ä»¶åŒæ—¶æ”¯æŒ<code>record</code>å’Œ<code>report</code>å‘½ä»¤ï¼Œå°±åƒ Linux ä¸€æ ·<code>perf</code>ã€‚åœ¨ NDK ä¸­ç¯é¡¾å››å‘¨ï¼Œæˆ‘è¿˜å‘ç°äº†ä¸€å †ç”¨ Python ç¼–å†™çš„å¸®åŠ©è„šæœ¬ï¼ˆä¾‹å¦‚<code>report_html.py</code>ï¼Œå¯ä»¥ç”Ÿæˆ HTML æŠ¥å‘Šï¼‰ã€‚æ·±å…¥äº†è§£è¿™äº›è„šæœ¬ï¼Œæˆ‘å‘ç°å®ƒä»¬åˆ©ç”¨äº†<code>libsimpleperf_report.so</code>å¤„ç†æ”¶é›†åˆ°çš„é…ç½®æ–‡ä»¶çš„è§£æå’Œç¬¦å·åŒ–çš„åº“ã€‚æ­¤åº“çš„ API å®šä¹‰<a href="https://android.googlesource.com/platform/system/extras/&#43;/refs/heads/master/simpleperf/report_lib_interface.cpp#34" target="_blank" rel="noopener noreffer"><code>simpleperf/report_lib_interface.cpp</code></a>åœ¨<code>simpleperf</code>æºæ–‡ä»¶ çš„é¡¶éƒ¨ã€‚</p>
<p>ä½¿ç”¨<a href="https://pub.dev/packages/ffigen" target="_blank" rel="noopener noreffer"><code>ffigen</code></a>æˆ‘<code>dart:ffi</code> ä¸ºæ­¤åº“ç”Ÿæˆçš„åŸºäºç»‘å®šï¼Œå…è®¸æˆ‘ä»<code>benchmark_harness</code> è„šæœ¬ä¸­ä½¿ç”¨å®ƒæ¥å¤„ç†æ”¶é›†çš„åˆ†ææ ·æœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">final reportLib = report_bindings.NativeLibrary(
    ffi.DynamicLibrary.open(ndk.simpleperfReportLib));

Future&lt;void&gt; _printProfile(String profileData) async {
  final session = reportLib.CreateReportLib();
  reportLib.SetRecordFile(session, Utf8.toUtf8(profileData).cast());

  // Iterate over all collected samples.
  for (;;) {
    final sample = reportLib.GetNextSample(session);
    if (sample == ffi.nullptr) {
      break;
    }
    final period = sample.ref.period;
    final symbol = reportLib.GetSymbolOfCurrentSample(session);

    final dsoName = Utf8.fromUtf8(symbol.ref.dso_name.cast());
    final symbolName = Utf8.fromUtf8(symbol.ref.symbol_name.cast());

    // Process sample for the symbol [symbolName] in dso [dsoName] and collect
    // aggregate statistics (samples per symbol, total sampling period, etc).
    // ...
  }

  // Report top N hottest symbols
}
</code></pre></td></tr></table>
</div>
</div><p>å½“æˆ‘ç¬¬ä¸€æ¬¡è¿è¡Œå®ƒæ—¶ï¼Œæˆ‘å‘ç°<code>simpleperf</code>æ— è®º for <code>libapp.so</code>ï¼ˆåŒ…å« AOT ç¼–è¯‘çš„ Dart ä»£ç ï¼‰è¿˜æ˜¯ for <code>libflutter.so</code> ï¼ˆåŒ…å« Flutter å¼•æ“ä»£ç ï¼‰éƒ½ä¸èƒ½çœŸæ­£å°†å¤§å¤šæ•°æ ·æœ¬å½’å› äºä¸€ä¸ªæœ‰æ„ä¹‰çš„ç¬¦å· ã€‚è¿™æ˜¯æˆ‘æ”¶åˆ°çš„ç¬¬ä¸€ä»½æŠ¥å‘Šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Hot methods when running allocateGrowableArray:
 88.24% _kDartIsolateSnapshotInstructions (libapp.so)
  4.04% unknown (libflutter.so)
  3.15% unknown ([kernel.kallsyms])
  1.44% pthread_mutex_lock (libc.so)
  1.30% pthread_mutex_unlock (libc.so)
  ...
</code></pre></td></tr></table>
</div>
</div><p>è¿™å¹¶ä¸å¥‡æ€ªï¼šè¿™ä¸¤ä¸ªåº“éƒ½è¢«å‰¥ç¦»äº†ï¼Œå¹¶ä¸”ä¸åŒ…å«ä»»ä½•æœ‰ç”¨çš„ç¬¦å·ä¿¡æ¯ä»¥<code>simpleperf</code>ä¾›ä½¿ç”¨ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œ<code>libflutter.so</code>ç¬¦å·å¯ä»¥ä» Cloud Storage ä¸­è·å–ï¼Œå…¶ä¸­æ„å»ºåŸºç¡€æ¶æ„æ­£åœ¨å½’æ¡£å®ƒä»¬ï¼Œä¾‹å¦‚ï¼Œæäº¤æ—¶ Flutter å¼•æ“çš„ ARM64 Android ç‰ˆæœ¬æ„å»ºçš„ç¬¦å·<code>e115066d...</code> é©»ç•™åœ¨ <code>gs://flutter_infra/flutter/e115066d.../android-arm64-release/symbols.zip</code>. å°±åœ¨å‡ ä¸ªæœˆå‰ï¼Œæˆ‘ç¼–å†™äº†ä¸€äº› Dart ä»£ç ï¼Œç”¨äºä¸‹è½½å’Œç¼“å­˜åŸºäºæäº¤å“ˆå¸Œçš„ Flutter å¼•æ“ç¬¦å· for <a href="https://github.com/flutter-symbolizer-bot" target="_blank" rel="noopener noreffer"><code>@flutter-symbolizer-bot</code></a>ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥åœ¨è¿™é‡Œé‡ç”¨å®Œå…¨ç›¸åŒçš„ä»£ç ã€‚</p>
<p>è·å–ç¬¦å·<code>libapp.so</code>æ˜¯ä¸€ä¸ªæ›´æœ‰è¶£çš„é—®é¢˜ã€‚Dart VM AOT ç¼–è¯‘å™¨èƒ½å¤Ÿåœ¨ ELF äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ç”Ÿæˆ DWARF è°ƒè¯•éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œä»…ä»…é€šè¿‡<code>--extra-gen-snapshot-options=--dwarf-stack-traces</code>å¹¶ä¸èƒ½è®©æˆ‘ä»¬åˆ°è¾¾é‚£é‡Œï¼š<code>libapp.so</code>ä»ç„¶ä¼šç¼ºå°‘ç¬¦å·ã€‚å¯¹ Flutter CLI æºä»£ç çš„æ£€æŸ¥è¡¨æ˜ï¼Œå®ƒæ€»æ˜¯ç®€å•åœ°<a href="https://github.com/flutter/flutter/blob/master/packages/flutter_tools/lib/src/base/build.dart#L143-L157" target="_blank" rel="noopener noreffer">æŒ‡ç¤º AOT</a>ç¼–è¯‘å™¨ç”Ÿæˆå‰¥ç¦»çš„è¾“å‡ºã€‚ç†Ÿæ‚‰é«˜çº§ Flutter å·¥å…·é€‰é¡¹çš„ç”¨æˆ·å¯èƒ½çŸ¥é“<code>--split-debug-info=...</code>flagï¼Œå®ƒæŒ‡ç¤º AOT ç¼–è¯‘å™¨ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ ELF æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åªåŒ…å« DWARF éƒ¨åˆ†ï¼Œä½†ä¸åŒ…å«å¿«ç…§æœ‰æ•ˆè´Ÿè½½æœ¬èº«ã€‚è¿™ä¸ªæ–‡ä»¶è¶³ä»¥è¿›è¡Œç¬¦å·åŒ–ï¼Œä½†ä¸å¹¸çš„æ˜¯ä¸èƒ½å¾ˆå¥½åœ°ä¸<code>llvm-objdump</code>. GNU<code>objdump</code>æ”¯æŒé€šè¿‡ å‘ç°çš„å•ç‹¬è°ƒè¯•ä¿¡æ¯<code>.gnu_debuglink</code>ï¼Œä½†æ··åˆæºä»£ç å’Œåæ±‡ç¼–ç­‰æŸäº›åŠŸèƒ½åœ¨æ­¤æ¨¡å¼ä¸‹ä¼¼ä¹ä¸èµ·ä½œç”¨ã€‚</p>
<p>å‡ºäºåŸå‹è®¾è®¡çš„ç›®çš„ï¼Œæˆ‘é€‰æ‹©ä¿®è¡¥<code>flutter</code>CLI ä»¥å…è®¸ç”¨æˆ·é€šè¿‡<code>--no-strip</code>åœ¨<code>--extra-gen-snapshot-options</code>.</p>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬æ„å»ºåŸºå‡†æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™ DWARF è°ƒè¯•ä¿¡æ¯ <code>libapp.so</code>ï¼Œç„¶åå°†å…¶ç”¨äºç¬¦å·åŒ–ï¼Œä½¿æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶æ›´å…·ä¿¡æ¯æ€§ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Hot methods when running allocateGrowableArray:
 54.17% Precompiled_Stub__iso_stub_AllocateArrayStub (libapp.so)
 14.29% Precompiled______measuredLoop_allocateGrowableArray_21146765_1230 (libapp.so)
  8.01% Precompiled__GrowableList_0150898__GrowableList_0150898__withData_0150898_136 (libapp.so)
  7.63% Precompiled__GrowableList_0150898__GrowableList_0150898__164 (libapp.so)
  4.96% Precompiled__GrowableList_0150898__allocateData_0150898_161 (libapp.so)
  3.66% unknown ([kernel.kallsyms])
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘æ›´è¿›ä¸€æ­¥ï¼Œå¹¶ä½¿ç”¨ DWARF ä¸­å¯ç”¨çš„ä¿¡æ¯æ¥æ¼‚äº®åœ°æ‰“å°ç¬¦å·åç§°ï¼ˆè¿™<code>simpleperf</code>ä¼¼ä¹å¹¶ä¸è¡Œï¼‰ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘å®é™…ä¸Šä¸å¿…æ‰‹åŠ¨è§£æ DWARFï¼Œ<code>package:native_stack_traces</code> å·²ç»æ‹¥æœ‰æ‰€æœ‰å¿…è¦çš„å·¥å…·æ¥ä¸ºæˆ‘ä»¬å¤„ç† ELF/DWARF è§£æï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">String _userFriendlyName(Dwarf dwarf, elf_lib.Elf elf, String symbol) {
  final elfSymbol = elf.staticSymbolFor(symbol);
  if (elfSymbol != null) {
    final callInfo = dwarf.callInfoFor(elfSymbol.value);
    if (callInfo != null &amp;&amp; callInfo.isNotEmpty) {
      final lastInfo = callInfo.last;
      if (lastInfo is DartCallInfo) {
        return lastInfo.function
            .replaceFirst(r&#39;_$measuredLoop$&#39;, &#39;measured loop for &#39;);
      }
      return lastInfo.toString();
    }
  }
  return symbol.replaceFirst(&#39;Precompiled_Stub__iso_stub_&#39;, &#39;Stub::&#39;);
}
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¼šäº§ç”Ÿæ›´å…·å¯è¯»æ€§çš„è¾“å‡ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ flutter run benchmark_harness report
Results for lib/main.benchmark.dart
allocateFixedArray: 0.000006573274731636047 ms/iteration (fastest)
allocateGrowableArray: 0.00020492076873779297 ms/iteration (31.2 times as slow)

Hot methods when running allocateFixedArray:
 99.64% measured loop for allocateFixedArray (libapp.so)

Hot methods when running allocateGrowableArray:
 54.17% Stub::AllocateArrayStub (libapp.so)
 14.29% measured loop for allocateGrowableArray (libapp.so)
  8.01% new _GrowableList._withData (libapp.so)
  7.63% new _GrowableList (libapp.so)
  4.96% _GrowableList._allocateData (libapp.so)
  3.66% unknown ([kernel.kallsyms])
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥çœ‹åˆ°åŸºå‡†æµ‹è¯•çš„è¡Œä¸ºä¼¼ä¹ç•¥æœ‰ä¸åŒï¼š<code>allocateFixedArray</code>å°†æ‰€æœ‰æ—¶é—´éƒ½èŠ±åœ¨å…¶æµ‹é‡å¾ªç¯ä¸­ï¼Œè€Œ <code>allocateGrowableArray</code>å°†æ—¶é—´èŠ±åœ¨ä¸æ•°ç»„åˆ†é…ç›¸å…³çš„å„ç§æ–¹æ³•ä¸Šã€‚</p>
<p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ä¸ºè¿™ä¸¤ä¸ªæµ‹é‡å¾ªç¯ç”Ÿæˆçš„æœ¬æœºä»£ç ã€‚</p>
<p>æœ‰å¤šç§å¯èƒ½çš„æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œä¾‹å¦‚æˆ‘å¯ä»¥é€‰æ‹©å°†æ­¤ä»»åŠ¡å§”æ‰˜ç»™<code>perf annotate</code>æˆ–ç±»ä¼¼çš„ä¸œè¥¿ã€‚ç„¶è€Œ<code>perf</code> ï¼Œåœ¨æœç´¢ç¬¦å·æ—¶å¯¹æ–‡ä»¶å¤¹ç»“æ„ç›¸å½“æŒ‘å‰”ï¼Œè€Œä¸”ä¼¼ä¹æ²¡æœ‰ä¸€ä¸ª NDK è„šæœ¬ç¬¦åˆè¦æ±‚ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©åªä½¿ç”¨ <code>llvm-objdump</code>åˆ†æä¿¡æ¯å¹¶æ³¨é‡Šç»“æœã€‚</p>
<p>é€šè¿‡ä¸€äº›åæœŸå¤„ç†ï¼Œä½¿ç”¨ Dart VM ç‰¹å®šåç§°ä½œä¸ºä¿ç•™å¯„å­˜å™¨<code>thr</code>ï¼ˆä¸ºå½“å‰<code>Thread</code>æŒ‡é’ˆä¿ç•™ï¼‰å’Œå¯¹ç¬¦å·åç§°ï¼ˆé€šè¿‡<code>_userFriendlyName</code>å¸®åŠ©ç¨‹åºï¼‰è¿›è¡Œè§£æ„ï¼Œæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Hot methods when running allocateFixedArray:
 99.64% measured loop for allocateFixedArray (libapp.so)
                      0: stp	fp, lr, [sp, #-16]!
                      4: mov	fp, sp
                      8: ldr	x2, [fp, #16]
           7.87%      c: ldr	x16, [thr, #64]
          18.40%     10: cmp	sp, x16
           9.30%     14: b.ls	-&gt;60
           8.88%     18: cmp	x2, null
                     1c: b.eq	-&gt;68
           9.65%     20: asr	x3, x2, #1
                     24: tbz	w2, #0, -&gt;2c
                     28: ldur	x3, [x2, #7]
           9.45%     2c: sub	x2, x3, #1
                     30: cmp	x3, #0
           9.85%     34: b.le	-&gt;50
           9.72%     38: adds	x0, x2, x2
                     3c: b.vc	-&gt;48
                     40: bl	Stub::AllocateMintSharedWithoutFPURegsStub
                     44: stur	x2, [x0, #7]
           8.90%     48: mov	x2, x0
           7.60%     4c: b.al	-&gt;c
                     50: mov	x0, null
                     54: mov	sp, fp
                     58: ldp	fp, lr, [sp], #16
                     5c: ret
                     60: bl	Stub::StackOverflowSharedWithoutFPURegsStub
                     64: b.al	-&gt;18
                     68: bl	Stub::NullErrorSharedWithoutFPURegsStub
</code></pre></td></tr></table>
</div>
</div><p>ç†Ÿæ‚‰ ARM æ±‡ç¼–è¯­è¨€çš„å¼€å‘äººå‘˜å¯èƒ½èƒ½å¤Ÿä»…ä»è¿™ä¸ªè¾“å‡ºä¸­å‘ç°æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•çš„é—®é¢˜ï¼ˆæ˜¯çš„ï¼Œæ˜¾ç„¶å­˜åœ¨é—®é¢˜ï¼‰ã€‚</p>
<p>ä½†æ˜¯æˆ‘å†³å®šèŠ±æ›´å¤šçš„æ—¶é—´åœ¨ä¸Šé¢ï¼Œå¹¶åœ¨ç¨‹åºé›†ä¹‹ä¸Šè¦†ç›–æœ‰å…³ Dart VM ç¼–è¯‘å™¨çš„ä¸­é—´è¯­è¨€çš„ä¿¡æ¯ï¼Œä½¿å…¶æ›´å®¹æ˜“ç†è§£ã€‚</p>
<p>åœ¨å†…éƒ¨ï¼Œæˆ‘ä»¬çš„ç¼–è¯‘å™¨æ”¯æŒä½¿ç”¨äººç±»å¯è¯»çš„æ³¨é‡Šæ¥æ³¨é‡Šå®ƒç”Ÿæˆçš„æœºå™¨ä»£ç ï¼Œå…¶ä¸­åŒ…æ‹¬æè¿°ç”Ÿæˆç‰¹å®šæœºå™¨ä»£ç ç‰‡æ®µçš„ ILã€‚</p>
<p>æˆ‘å·²ç»å°è¯•äº†ä¸¤ç§ä¸åŒçš„è·¯å¾„ï¼Œæˆ‘è€ƒè™‘è¿‡ä» AOT ç¼–è¯‘å™¨ä¸­è·å–è¿™äº›ä¿¡æ¯ï¼š</p>
<ul>
<li>æ·»åŠ ä¸€ä¸ªæ ‡å¿—<code>--write-code-comments-to=output.json</code>ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å°†åç§»é‡åˆ°æ³¨é‡Šçš„æ˜ å°„è½¬å‚¨åˆ° JSON æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯• CLI ä¸­æ‘„å–æ­¤ JSONã€‚</li>
<li>æ·»åŠ ä¸€ä¸ªæ ‡å¿—<code>--write-code-comments-as-synthetic-source-to=comments.txt</code>ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨ä»æ‰€æœ‰ä»£ç æ³¨é‡Šä¸­åˆæˆä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ï¼Œå¹¶å°†åç§»é‡åˆ°æ³¨é‡Šçš„æ˜ å°„ä½œä¸º DWARF è¡Œç¨‹åºå†™å…¥<code>.debug_line</code> éƒ¨åˆ†ã€‚</li>
</ul>
<p>æœ€åæˆ‘å†³å®šç¬¬äºŒç§æ–¹æ³•æ›´å¥½ï¼Œå› ä¸ºå®ƒä½¿<em>ä»»ä½•</em>èƒ½å¤Ÿç†è§£<code>.debug_line</code>åœ¨åæ±‡ç¼–çš„åŒæ—¶æ˜¾ç¤ºä»£ç æ³¨é‡Šçš„å·¥å…·æˆä¸ºå¯èƒ½ï¼ˆä¾‹å¦‚ï¼Œ<code>gdb</code>ä¹Ÿå°†å¼€å§‹æ˜¾ç¤ºå®ƒï¼‰ã€‚</p>
<p>è¿™æ˜¯<a href="https://github.com/mraleph/sdk/commit/6612e52dc01cc843f04a205b2dc56c2d0d69d852#diff-c21c72c7a0fbe730891dd0c86bd141f23c33fddc11b512025ac7381fbda7563a" target="_blank" rel="noopener noreffer">æˆ‘</a>é’ˆå¯¹ Dart SDK å®ç°å¿…è¦ç®¡é“çš„<a href="https://github.com/mraleph/sdk/commit/6612e52dc01cc843f04a205b2dc56c2d0d69d852#diff-c21c72c7a0fbe730891dd0c86bd141f23c33fddc11b512025ac7381fbda7563a" target="_blank" rel="noopener noreffer">è¡¥ä¸</a>ã€‚æœ‰äº†è¿™ä¸ªï¼Œæˆ‘å”¯ä¸€è¦åšçš„æ”¹å˜å°±æ˜¯æ·»åŠ <code>-S</code>åˆ°<code>llvm-objdump</code> è°ƒç”¨ä¸­ï¼Œå®ƒå¤„ç†å…¶ä½™çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Hot methods when running allocateFixedArray:
 99.64% measured loop for allocateFixedArray (libapp.so)
                         ;; Enter frame
                      0: stp	fp, lr, [sp, #-16]!
                      4: mov	fp, sp
                         ;; ParallelMove r2 &lt;- S+2
                      8: ldr	x2, [fp, #16]
                         ;; CheckStackOverflow:30(stack=0, loop=1)
           7.87%      c: ldr	x16, [thr, #64]
          18.40%     10: cmp	sp, x16
           9.30%     14: b.ls	-&gt;60
                         ;; CheckNull:10(v3, NoSuchMethodError) T{int}
           8.88%     18: cmp	x2, null
                     1c: b.eq	-&gt;68
                         ;; v26 &lt;- UnboxInt64(v3 T{int}) T{int}
           9.65%     20: asr	x3, x2, #1
                     24: tbz	w2, #0, -&gt;2c
                     28: ldur	x3, [x2, #7]
                         ;; v6 &lt;- BinaryInt64Op(- [tr], v26 T{int}, v32) T{int}
           9.45%     2c: sub	x2, x3, #1
                         ;; Branch if RelationalOp(&gt;, v26 T{int}, v34) T{bool} goto (3, 5)
                     30: cmp	x3, #0
           9.85%     34: b.le	-&gt;50
                         ;; v30 &lt;- BoxInt64(v6) T{int}
           9.72%     38: adds	x0, x2, x2
                     3c: b.vc	-&gt;48
                     40: bl	Stub::AllocateMintSharedWithoutFPURegsStub
                     44: stur	x2, [x0, #7]
                         ;; ParallelMove r2 &lt;- r0 goto:28 B4
           8.90%     48: mov	x2, x0
           7.60%     4c: b.al	-&gt;c
                         ;; ParallelMove r0 &lt;- C
                     50: mov	x0, null
                         ;; Return:36(v0)
                     54: mov	sp, fp
                     58: ldp	fp, lr, [sp], #16
                     5c: ret
                         ;; CheckStackOverflowSlowPath
                     60: bl	Stub::StackOverflowSharedWithoutFPURegsStub
                     64: b.al	-&gt;18
                         ;; slow path check null (nsm) operation
                     68: bl	Stub::NullErrorSharedWithoutFPURegsStub

Hot methods when running allocateGrowableArray:
 54.17% Stub::AllocateArrayStub (libapp.so)
 14.29% measured loop for allocateGrowableArray (libapp.so)
                         ;; Enter frame
                      0: stp	fp, lr, [sp, #-16]!
                      4: mov	fp, sp
                      8: sub	sp, sp, #16
                         ;; CheckStackOverflow:8(stack=0, loop=0)
                      c: ldr	x16, [thr, #64]
                     10: cmp	sp, x16
                     14: b.ls	-&gt;94
                         ;; v36 &lt;- UnboxedConstant:32(#32) [32, 32] T{_Smi}
                     18: mov	x0, #32
                         ;; ParallelMove r1 &lt;- S+2, S-2 &lt;- r0
                     1c: ldr	x1, [fp, #16]
                     20: stur	x0, [fp, #-16]
                         ;; CheckStackOverflow:30(stack=0, loop=1)
                     24: ldr	x16, [thr, #64]
           0.73%     28: cmp	sp, x16
                     2c: b.ls	-&gt;9c
                         ;; CheckNull:10(v3, NoSuchMethodError) T{int}
           0.33%     30: cmp	x1, null
                     34: b.eq	-&gt;a4
                         ;; v26 &lt;- UnboxInt64(v3 T{int}) T{int}
           0.30%     38: asr	x2, x1, #1
                     3c: tbz	w1, #0, -&gt;44
                     40: ldur	x2, [x1, #7]
                         ;; v6 &lt;- BinaryInt64Op(- [tr], v26 T{int}, v32) T{int}
           0.35%     44: sub	x1, x2, #1
                         ;; ParallelMove S-1 &lt;- r1
                     48: stur	x1, [fp, #-8]
                         ;; Branch if RelationalOp(&gt;, v26 T{int}, v34) T{bool} goto (3, 5)
          10.41%     4c: cmp	x2, #0
                     50: b.le	-&gt;84
                         ;; PushArgument(v18)
           0.29%     54: ldr	x16, [pp, #5160]
           0.35%     58: stp	x0, x16, [sp, #-16]!
                         ;; StaticCall:10( _GrowableList@0150898.&lt;0&gt; v18, v36, result_type = T{_GrowableList})
                     5c: bl	new _GrowableList
           0.33%     60: add	sp, sp, #16
                         ;; ParallelMove r2 &lt;- S-1
                     64: ldur	x2, [fp, #-8]
                         ;; v30 &lt;- BoxInt64(v6) T{int}
           0.53%     68: adds	x0, x2, x2
                     6c: b.vc	-&gt;78
                     70: bl	Stub::AllocateMintSharedWithoutFPURegsStub
                     74: stur	x2, [x0, #7]
                         ;; ParallelMove r1 &lt;- r0, r0 &lt;- S-2 goto:28 B4
           0.29%     78: mov	x1, x0
                     7c: ldur	x0, [fp, #-16]
           0.38%     80: b.al	-&gt;24
                         ;; ParallelMove r0 &lt;- C
                     84: mov	x0, null
                         ;; Return:36(v0)
                     88: mov	sp, fp
                     8c: ldp	fp, lr, [sp], #16
                     90: ret
                         ;; CheckStackOverflowSlowPath
                     94: bl	Stub::StackOverflowSharedWithoutFPURegsStub
                     98: b.al	-&gt;18
                         ;; CheckStackOverflowSlowPath
                     9c: bl	Stub::StackOverflowSharedWithoutFPURegsStub
                     a0: b.al	-&gt;30
                         ;; slow path check null (nsm) operation
                     a4: bl	Stub::NullErrorSharedWithoutFPURegsStub
  8.01% new _GrowableList._withData (libapp.so)
  7.63% new _GrowableList (libapp.so)
  4.96% _GrowableList._allocateData (libapp.so)
  3.66% unknown ([kernel.kallsyms])
  ..(run with -v to disassemble all hot methods in libapp.so)..
</code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å®ƒåº”è¯¥åœ¨<code>allocateFixedArray</code>å®é™…ä¸Šä¸åŒ…å«<em>ä»»ä½•æ•°ç»„åˆ†é…</em>çš„è¾“å‡ºä¸­å¯è§ï¼Œå®ƒè¢«ç¼–è¯‘å™¨æ¶ˆé™¤ï¼ˆæ²‰æ²¡ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•ä¼¼ä¹å°†ç©º<code>while (N-- &gt; 0);</code>å¾ªç¯çš„æ€§èƒ½ä¸å®é™…æ‰§è¡Œä¸€äº›æ•°ç»„åˆ†é…çš„å¾ªç¯çš„æ€§èƒ½è¿›è¡Œæ¯”è¾ƒ .</p>
<p>ç„¶è€Œï¼Œç©ºå¾ªç¯è¿œéå¾®ä¸è¶³é“ã€‚å®ƒæœ¬èº«ä¼¼ä¹åŒ…å«ä¸¤ä¸ªå¼€é”€æ¥æºï¼š</p>
<ul>
<li>
<p>å˜é‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-plaintext" data-lang="plaintext">numIterations
</code></pre></td></tr></table>
</div>
</div><p>ä¼¼ä¹åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£æ—¶éƒ½è¢«æ‹†ç®±å’Œé‡æ–°è£…ç®±ï¼Œä»ä»¥ä¸‹å®ç°çš„æŒ‡ä»¤åºåˆ—ä¸­å¯ä»¥æ˜æ˜¾çœ‹å‡º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-plaintext" data-lang="plaintext">numIterations--
</code></pre></td></tr></table>
</div>
</div><p>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">;; CheckNull:10(v3, NoSuchMethodError) T{int}
18: cmp x2, null
1c: b.eq -&gt;68
  ;; v26 &lt;- UnboxInt64(v3 T{int}) T{int}
20: asr x3, x2, #1
24: tbz w2, #0, -&gt;2c
28: ldur x3, [x2, #7]
  ;; v6 &lt;- BinaryInt64Op(- [tr], v26 T{int}, v32) T{int}
2c: sub x2, x3, #1
  &lt;...&gt;
  ;; v30 &lt;- BoxInt64(v6) T{int}
38: adds x0, x2, x2
3c: b.vc -&gt;48
40: bl Stub::AllocateMintSharedWithoutFPURegsStub
44: stur x2, [x0, #7]
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å¾ªç¯å¤´åŒ…å«</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-plaintext" data-lang="plaintext">CheckStackOverflow
</code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œå†…å­˜åŠ è½½å’Œæ¯æ¬¡å¾ªç¯è¿­ä»£æ¯”è¾ƒçš„æŒ‡ä»¤ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">;; CheckStackOverflow:30(stack=0, loop=1)
24: ldr x16, [thr, #64]
28: cmp sp, x16
2c: b.ls -&gt;9c
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>å¯¹äºå‡†ç¡®çš„å¾®åŸºå‡†æµ‹è¯•ï¼Œæˆ‘ä»¬å½“ç„¶åº”è¯¥åŠªåŠ›å°†æµ‹é‡å¾ªç¯çš„å¼€é”€å‡å°‘åˆ°æœ€ä½é™åº¦ã€‚</p>
<h3 id="é˜²æ­¢-numiterations">é˜²æ­¢ <code>numIterations</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">void _$measuredLoop$allocateGrowableArray(int numIterations) {
  while (numIterations-- &gt; 0) {
    lib.allocateGrowableArray();
  }
}
</code></pre></td></tr></table>
</div>
</div><p>ä¸ºä»€ä¹ˆè¦è¢«<code>numIterations</code>ç¼–è¯‘å™¨è£…ç®±ï¼Ÿè¿™é‡Œæœ‰å¤šç§å› ç´ åœ¨èµ·ä½œç”¨ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œç¼–è¯‘å™¨æ ¹æœ¬æ— æ³•è¯æ˜å®ƒ<code>numIterations</code>ä¸åœ¨<code>null</code>å‡½æ•°çš„å…¥å£å¤„ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¯æµ‹é‡çš„å¾ªç¯æ–¹æ³•æ¥è°ƒç”¨å®ƒã€‚<em>TFA</em>ï¼ˆ<em>ç±»å‹æµåˆ†æ</em>ï¼Œæˆ‘ä»¬çš„å…¨å±€ç±»å‹ä¼ æ’­ç®—æ³•ï¼‰ä¸ä¼šå°è¯•æ¨æ–­é—­åŒ…å‚æ•°çš„ç²¾ç¡®ç±»å‹ä¿¡æ¯ã€‚å¦‚æœæˆ‘ä»¬çš„ä»£ç æ˜¯ä½¿ç”¨ç±»æ„å»ºçš„ï¼Œä¾‹å¦‚ï¼šå¦‚æœæˆ‘ä»¬åœ¨é»˜è®¤æƒ…å†µä¸‹ä»¥å£°éŸ³ä¸å¯ä¸ºç©º (NNBD) æ¨¡å¼è¿è¡Œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¹Ÿå°†èƒ½å¤Ÿä¾èµ–äº<code>numIterations</code>æ°¸è¿œä¸èƒ½ä¸º<code>null</code>. è¿™è¯´æ˜äº† NNBD çš„å¥½å¤„ä¹‹ä¸€ï¼šä¸ºç¼–è¯‘å™¨æä¾›æ›´å¤šä¿¡æ¯ä»¥ä¾›ä½¿ç”¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">abstract class MeasuredLoop {
  void run(int numIterations);
}

class Loop$allocateGrowableArray extends MeasuredLoop {
  void run(int numIterations) =&gt;
      _$measuredLoop$allocateGrowableArray(numIterations);
}

void main() {
  await benchmark_runner.runBenchmarks(const {
    // Use class instead of tearing off _$measuredLoop$allocateGrowableArray
    &#39;allocateGrowableArray&#39;: Loop$allocateGrowableArray(),
  });
}
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åç¼–è¯‘å™¨å°†èƒ½å¤Ÿæ¨æ–­å‡ºå®ƒ<code>numIterations</code>æ°¸è¿œä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”ä¸ä»…<code>numIterations</code>åœ¨å†…éƒ¨æœ¬åœ°æ‹†ç®±<code>run</code>ï¼Œ<code>_$measuredLoop$...</code>è€Œä¸”ç”šè‡³æ›´æ”¹è¿™ä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨çº¦å®šä»¥åœ¨æ²¡æœ‰è£…ç®±çš„æƒ…å†µä¸‹ä¼ é€’å‚æ•°ã€‚</p>
<p>è¿™é€‚ç”¨äºæ–¹æ³•è€Œä¸é€‚ç”¨äºé—­åŒ…çš„åŸå› æ˜¯å› ä¸ºé™æ€ç±»å‹çš„æ–¹æ³•è°ƒç”¨æ¯”é™æ€ç±»å‹çš„é—­åŒ…è°ƒç”¨ä¸ºç¼–è¯‘å™¨æä¾›äº†æ›´å¤šå…³äºæ½œåœ¨è¢«è°ƒç”¨è€…çš„ä¿¡æ¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">class Loop$allocateGrowableArray extends MeasuredLoop {
  void run(int numIterations) {
    // Can only be reached from a call-site where
    // static type of a receiver is either [dynamic] or
    // related to [Loop$allocateGrowableArray].
  }
}

MeasuredLoop loop;
loop.run(...);  // Can invoke only overrides of [MeasuredLoop.run].

// ---------------------------------------------------------

var g = (int numIterations) {
  // Can be reached from any closure call-site with a compatible
  // function type and invocation signature.
};

void Function(int) f;
f(...);  // Can reach any compatible closure in the program.
</code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ TFA åšäº†ä¸€ä¸ªéå¸¸ä¿å®ˆçš„è¿‘ä¼¼ï¼Œå‡è®¾ä»»ä½•é—­åŒ…éƒ½å¯ä»¥ä»å…¶ä»–ä»»ä½•åœ°æ–¹è°ƒç”¨ã€‚è¿™å½“ç„¶å¯ä»¥æ”¹è¿›ï¼šä¾‹å¦‚ï¼ŒTFA å¯ä»¥ä½¿ç”¨é™æ€ç±»å‹ä¿¡æ¯æ¥ç¼©å°æ¯ä¸ªé—­åŒ…çš„æ½œåœ¨è°ƒç”¨ç‚¹ã€‚è¿™å¯ä»¥æ›´è¿›ä¸€æ­¥â€”â€”TFA å¯ä»¥å°è¯•é€šè¿‡ç¨‹åºè·Ÿè¸ªå…³é—­æµç¨‹å¹¶å°è¯•ç¡®å®šå®ƒå¯ä»¥åˆ°è¾¾å“ªäº›è°ƒç”¨ç«™ç‚¹ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„åˆ†æã€‚</p>
<p>é‰´äº TFA ä¸èƒ½æ¨æ–­<code>numIterations</code>ä¸ºä»ä¸åŒ…å«ï¼Œ<code>null</code>æˆ‘ä»¬å¯èƒ½å¸Œæœ›é€šè¿‡åœ¨æµ‹é‡å¾ªç¯åŒ…è£…å™¨çš„å¼€å¤´æ·»åŠ æ˜¾å¼æ£€æŸ¥æ¥å¸®åŠ©å®ƒã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">void _$measuredLoop$allocateGrowableArray(int numIterations) {
  if (numIterations == null) throw &#39;Unexpected null!&#39;;
  while (numIterations-- &gt; 0) {
    lib.allocateGrowableArray();
  }
}
</code></pre></td></tr></table>
</div>
</div><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ— æµäºäº‹ï¼šå³ä½¿ç¼–è¯‘å™¨æ¨æ–­å‡º<code>numIterations</code>å®ƒæ°¸è¿œä¸ä¼š<code>null</code>åœ¨å¾ªç¯å†…ï¼Œå®ƒä»ç„¶ä¸ä¼šå¯¹å…¶è¿›è¡Œæ‹†ç®±ï¼Œå› ä¸ºå®ƒçš„æ‹†ç®±ç®—æ³•å¯¹äº<code>int</code>ç±»å‹å˜é‡è¿‡äºä¿å®ˆã€‚å¦‚æœæ‰€æœ‰åˆ°è¾¾å€¼éƒ½æ˜¯è£…ç®±æ“ä½œæˆ–å¸¸é‡ï¼Œåˆ™å½“å‰çš„å¯å‘å¼é›†ä»…å¯¹æ•´æ•°å˜é‡è¿›è¡Œæ‹†ç®±ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªéœ€è¦ä¿®å¤çš„é”™è¯¯ï¼Œä½†åŒæ—¶æˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ»¡è¶³è¿™ä¸ªè¦æ±‚ï¼šåœ¨è¿™é‡Œè°ˆè®ºæ‹†ç®±æ—¶ï¼Œæˆ‘å…è®¸è‡ªå·±æœ‰ç‚¹ä¸å‡†ç¡®ã€‚ç¼–è¯‘å™¨å®é™…ä¸Šå¹¶ä¸æ‹†ç®±<em>å˜é‡</em>ï¼Œå› ä¸ºå®ƒåœ¨ SSA å½¢å¼ä¸Šè¿è¡Œï¼Œè¯¥å½¢å¼ä¸å†åŒ…å«ä»»ä½•å˜é‡æ“ä½œã€‚è°ˆè®ºæ‹†ç®±<em>phis</em>ä¼šæ›´å‡†ç¡®ï¼Œä½†æˆ‘ä¸æƒ³è®©æ²¡æœ‰ç¼–è¯‘å™¨èƒŒæ™¯çš„è¯»è€…è¿‡å¤šæ··æ·†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">void _$measuredLoop$allocateGrowableArray(int numIterations) {
  // n will be unboxed because it is either
  //     Box(Unbox(numIterations) + 0) or Box(Unbox(n) - 1)
  var n = numIterations + 0;
  while (n-- &gt; 0) {
    lib.allocateGrowableArray();
  }
}
</code></pre></td></tr></table>
</div>
</div><h3 id="æ¶ˆé™¤-checkstackoverflow">æ¶ˆé™¤ <code>CheckStackOverflow</code></h3>
<p><code>CheckStackOverflow</code>ç¼–è¯‘å™¨æ’å…¥çš„æŒ‡ä»¤æœ‰åŒé‡ç›®çš„ï¼šå®ƒä»¬æ£€æŸ¥å †æ ˆæº¢å‡ºï¼ˆé¡¾åæ€ä¹‰ï¼‰ï¼Œä½†ä¹Ÿç”¨ä½œä¸­æ–­ç‚¹ï¼Œå…è®¸ VM å¹²å‡€åœ°ä¸­æ–­æ‰§è¡Œ Dart ä»£ç çš„çº¿ç¨‹ã€‚ä¾‹å¦‚ï¼ŒGC å¯ä»¥ä½¿ç”¨æ­¤æœºåˆ¶å°† mutator çº¿ç¨‹åœæ”¾åœ¨å®‰å…¨ç‚¹ã€‚<code>CheckStackOverflow</code>çš„é€Ÿåº¦ç›¸å½“å¿«ï¼šå®ƒä»¬ç”±é€šå¸¸ä¼šè®¿é—® CPU ç¼“å­˜çš„å†…å­˜è´Ÿè½½å’Œå‡ ä¹ä»ä¸ä½¿ç”¨çš„æ¯”è¾ƒå’Œåˆ†æ”¯ç»„æˆã€‚ç„¶è€Œï¼Œå®ƒä»¬åœ¨éå¸¸ç´§å‡‘çš„å¾ªç¯ä¸­ä»ç„¶å…·æœ‰å¯è§çš„æˆæœ¬ã€‚</p>
<p>ä½œä¸ºä¸€é¡¹å®éªŒï¼Œæˆ‘æ›´æ”¹äº† VM ä»¥å®Œå…¨æ¶ˆé™¤<code>CheckStackOverflow</code>æ ‡æœ‰<code>@pragma('vm:no-interrupts')</code>.</p>
<p>æ¯æ¬¡è¿­ä»£æœ‰<code>CheckStackOverflow</code>æŒ‡ä»¤æ—¶ï¼Œç©ºå¾ªç¯éœ€è¦æ‰§è¡Œ<code>3.56 ns/iteration</code>ï¼Œæ²¡æœ‰æŒ‡ä»¤æ—¶ï¼Œç©ºå¾ªç¯çš„æ‰§è¡Œé€Ÿåº¦<code>1.78 ns/iteration</code>åŸºæœ¬ä¸Šæ˜¯åŸæ¥çš„ä¸¤å€ã€‚</p>
<p>ç©ºæµ‹é‡å›è·¯çš„æœ€ç»ˆå½¢çŠ¶æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">    ;; v9 &lt;- BinaryInt64Op(- [tr], v6 T{int}, v36) T{int}
24: sub    x0, x1, #1
    ;; Branch if RelationalOp(&gt;, v6 T{int}, v34) T{bool} goto (3, 5)
28: cmp    x1, #0
2c: b.le   -&gt;38
    ;; ParallelMove r1 &lt;- r0 goto:32 B4
30: mov    x1, x0
34: b.al   -&gt;24
</code></pre></td></tr></table>
</div>
</div><h3 id="é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–è®¡ç®—">é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–è®¡ç®—</h3>
<p>æœ€åä¸€æ­¥æ˜¯ä¿®å¤åŸºå‡†ä»¥é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æˆ‘ä»¬çš„è®¡ç®—ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯æ”¹å˜æ¯ä¸ªåŸºå‡†ä»¥è¿”å›å®ƒäº§ç”Ÿçš„å€¼å¹¶ä½¿æµ‹é‡å¾ªç¯æ¶ˆè€—è¿”å›å€¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// ubench/lib/main.dart

@benchmark
Object allocateFixedArray() {
  return List.filled(N, null, growable: false);
}

// ubench/lib/main.benchmark.dart
@pragma(&#39;vm:never-inline&#39;)
@pragma(&#39;vm:no-interrupts&#39;)
void _$measuredLoop$allocateFixedArray(int numIterations) {
  // ...
  while (n-- &gt; 0) {
    final result = lib.allocateFixedArray();
    // Call a special intrinsic from dart:_internal which keeps
    // the value alive and prevents it from being optimized out.
    // However does not result in any actual calls being produced.
    benchmark_runner.reachabilityFence(result);
  }
}
</code></pre></td></tr></table>
</div>
</div><h2 id="æœ€ç»ˆåŸºå‡†æµ‹è¯•ç»“æœ">æœ€ç»ˆåŸºå‡†æµ‹è¯•ç»“æœ</h2>
<p>ä½¿ç”¨åŸºå‡†å·¥å…·<em>å’Œ</em>åŸºå‡†æœ¬èº«å›ºå®šä»¥é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–åˆ—è¡¨åˆ†é…ï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹ç»“æœ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Results for lib/main.benchmark.dart
allocateFixedArray: 131.607 (Â±0.845) ns/iteration (fastest)
allocateGrowableArray: 177.443 (Â±1.603) ns/iteration (1.3 times as slow)

Hot methods when running allocateFixedArray:
 77.98% Stub::AllocateArrayStub (libapp.so)
  6.19% measured loop for allocateFixedArray (libapp.so)
  5.21% unknown ([kernel.kallsyms])
  1.16% pthread_mutex_lock (libc.so)
  1.16% pthread_mutex_unlock (libc.so)

Hot methods when running allocateGrowableArray:
 53.13% Stub::AllocateArrayStub (libapp.so)
 11.53% new _GrowableList._withData (libapp.so)
  9.35% new _GrowableList (libapp.so)
  8.15% measured loop for allocateGrowableArray (libapp.so)
  6.23% _GrowableList._allocateData (libapp.so)
  3.92% unknown ([kernel.kallsyms])
</code></pre></td></tr></table>
</div>
</div><p>å› æ­¤ï¼Œä¸åˆ†é…å…·æœ‰ 32 ä¸ªå…ƒç´ çš„å›ºå®šé•¿åº¦åˆ—è¡¨ç›¸æ¯”ï¼Œåˆ†é…å…·æœ‰ 32 ä¸ªå…ƒç´ çš„å¯å¢é•¿åˆ—è¡¨éœ€è¦å¤šå‡ºçº¦ 30% çš„æ—¶é—´ï¼Œè¿™æ¯”æˆ‘ä»¬ä½¿ç”¨åˆå§‹åŸºå‡†è·å¾—çš„ç»“æœè¦åˆç†å¾—å¤šã€‚</p>
<p>è¿™ä¹Ÿæ˜¯æœ‰é“ç†çš„ï¼šå¯å¢é•¿æ•°ç»„åªæ˜¯ä¸€ä¸ªåŒ…å«åœ¨å›ºå®šé•¿åº¦æ•°ç»„ä¸­çš„å¯¹è±¡ï¼Œå› æ­¤åˆ†é…å¯å¢é•¿æ•°ç»„æ¯”åˆ†é…å›ºå®šé•¿åº¦æ•°ç»„è¦æ…¢ä¸€äº›ï¼Œå› ä¸ºæ‚¨éœ€è¦åˆ†é…å’Œåˆå§‹åŒ–æ›´å¤šå†…å­˜ï¼Œå¹¶ä¸”éœ€è¦è·³è¿‡æ›´å¤šåœˆå¥—åˆ°è¾¾é‚£é‡Œï¼š<code>allocateFixedArray</code> å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨åˆ†é…æ•°ç»„çš„å­˜æ ¹ï¼ˆä¸€æ®µæ‰‹å†™æœºå™¨ä»£ç ï¼‰ä¸Šï¼Œåœ¨å®Œæˆ<code>allocateGrowableArray</code>è¿™é¡¹å·¥ä½œæ—¶æ¶‰åŠå¤šä¸ªåŠŸèƒ½ã€‚</p>
<h2 id="å…³äºåŸºå‡†æµ‹è¯•çš„æœ€åè¯„è®º">å…³äºåŸºå‡†æµ‹è¯•çš„æœ€åè¯„è®º</h2>
<p>æ€»çš„æ¥è¯´ï¼Œæˆ‘é€‰æ‹©åœ¨è¿™ç¯‡æ–‡ç« ä¸­å¿½ç•¥ä¸€äº›ä¸å¾®åŸºå‡†æµ‹è¯•ç›¸å…³çš„æœ€å›°éš¾çš„é—®é¢˜ï¼šä¾‹å¦‚ï¼Œæˆ‘å†³å®šå®Œå…¨å¿½ç•¥ JITï¼Œä¸“é—¨å…³æ³¨ AOTã€‚å¯¹ JIT è¿›è¡ŒåŸºå‡†æµ‹è¯•çœŸçš„å¾ˆéš¾ï¼Œå› ä¸ºå®ƒä»¬çš„è¡Œä¸ºå°±åƒæ´»çš„æœ‰æœºä½“ï¼Œå³ä½¿ç»è¿‡é•¿æ—¶é—´çš„é¢„çƒ­ï¼Œæ€§èƒ½ä¹Ÿä¼šå‡ºç°å‰§çƒˆæ³¢åŠ¨ï¼ˆå‚è§ä¾‹å¦‚<a href="https://soft-dev.org/pubs/html/barrett_bolz-tereick_killick_mount_tratt__virtual_machine_warmup_blows_hot_and_cold_v6/" target="_blank" rel="noopener noreffer">è™šæ‹Ÿæœºé¢„çƒ­å¹å†·çƒ­</a>è®ºæ–‡ï¼‰ã€‚æˆ‘è¿˜å†³å®šä¸“æ³¨äºç®€å•åŒ–çš„<em>å¹³å‡è¿è¥æˆæœ¬</em>æŒ‡æ ‡ï¼Œè¿™å¯èƒ½ä¼šéšè—ä¸€äº›é‡è¦ä½†ä¸ç»å¸¸å‡ºç°çš„å¼€é”€ã€‚æ•°ç»„åˆ†é…å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼šå®ƒé€šå¸¸å¯èƒ½ç›¸å½“ä¾¿å®œï¼Œä½†å®ƒå¯èƒ½ç»å¸¸è§¦å‘ GCâ€”â€”å…¶æˆæœ¬å°†ä¸å®æ—¶æ•°æ®é‡æˆæ­£æ¯”ï¼Œåœ¨å¾®åŸºå‡†æµ‹è¯•ä¸­å¯èƒ½æ¥è¿‘ 0ã€‚å¹³å‡æ•°ä»¥åƒè®¡çš„æ“ä½œå°†å®Œå…¨æ¶ˆé™¤ GC çš„æˆæœ¬ï¼Œä½†æ˜¯åœ¨å®é™…åº”ç”¨ç¨‹åºä¸­ï¼Œåƒè¿™æ ·çš„ GC å¯èƒ½å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´ä¸¢å¤±å¸§ã€‚</p>
<h2 id="ä¸‹ä¸€éƒ¨åˆ†">ä¸‹ä¸€éƒ¨åˆ†</h2>
<p>åœ¨æœ¬ç³»åˆ—çš„ç¬¬ 2 éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨åŸºå‡†æµ‹è¯•å·¥å…· CLIï¼Œæˆ‘åˆšåˆšå®æ–½æ¥å›ç­”æˆ‘åœ¨ Twitter ä¸Šé‡åˆ°çš„æ›´å¤šæ€§èƒ½é—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>å°†å­—æ®µåˆå§‹å€¼è®¾å®šé¡¹ä» æ›´æ”¹ä¸º<code>[]</code>å¦‚ä½•<code>List.filled(0, null)</code>å¯ä»¥æé«˜ä»£ç çš„æ€§èƒ½ï¼›</li>
<li><code>async</code>è¯­æ³•ç³–çš„æ€§èƒ½ç‰¹ç‚¹ï¼›</li>
<li>å½“æ‚¨é€šè¿‡åŠ¨æ€ç±»å‹å˜é‡è°ƒç”¨é—­åŒ…æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼›</li>
</ul></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2021-06-04</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://luckly.work/dart%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86/" data-title="ã€ŠDartå¾®åŸºå‡†æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ã€‹" data-hashtags="flutter,dart"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://luckly.work/dart%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86/" data-hashtag="flutter"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Hacker News" data-sharer="hackernews" data-url="https://luckly.work/dart%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86/" data-title="ã€ŠDartå¾®åŸºå‡†æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ã€‹"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://luckly.work/dart%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86/" data-title="ã€ŠDartå¾®åŸºå‡†æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ã€‹"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://luckly.work/dart%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86/" data-title="ã€ŠDartå¾®åŸºå‡†æµ‹è¯•ç¬¬ä¸€éƒ¨åˆ†ã€‹" data-image="https://luckly007.oss-cn-beijing.aliyuncs.com/img/f77be1f477e980732d57475d3ddb69d.png"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/flutter/">flutter</a>,&nbsp;<a href="/tags/dart/">dart</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/dart_vm%E7%9A%84%E7%9B%B8%E5%85%B3%E7%AE%80%E4%BB%8B%E4%B8%8E%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90/" class="prev" rel="prev" title="ã€ŠDart_VMçš„ç›¸å…³ç®€ä»‹ä¸è¿è¡Œæ¨¡å¼è§£æã€‹"><i class="fas fa-angle-left fa-fw"></i>ã€ŠDart_VMçš„ç›¸å…³ç®€ä»‹ä¸è¿è¡Œæ¨¡å¼è§£æã€‹</a>
            <a href="/emoji-support/" class="next" rel="next" title="Emoji æ”¯æŒ">Emoji æ”¯æŒ<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.1">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">æ—©èµ·çš„å¹´è½»äºº</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"åŒæ„","link":"äº†è§£æ›´å¤š","message":"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒ."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"æ—©èµ·çš„å¹´è½»äºº","id-2":"æ—©èµ·çš„å¹´è½»äºº"},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.zh-cn","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"algolia"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
